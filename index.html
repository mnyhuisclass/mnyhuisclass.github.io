<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interplanetary Practice: Mission Select</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- MathJax for high-quality math rendering -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;700&family=Space+Mono&display=swap');

        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: #05070a;
            color: #e2e8f0;
            overflow-x: hidden;
        }

        .mono { font-family: 'Space Mono', monospace; }

        .star-field {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
            overflow: hidden;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.5;
            animation: twinkle var(--duration) infinite ease-in-out;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
        }

        .glow-text {
            text-shadow: 0 0 10px rgba(96, 165, 250, 0.5);
        }

        .mission-card {
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            height: 100%;
            cursor: pointer;
        }
        .mission-card:hover {
            transform: translateY(-5px);
        }
        
        .card-blue:hover { border-color: #3b82f6; background: rgba(59, 130, 246, 0.1); box-shadow: 0 0 20px rgba(59, 130, 246, 0.2); }
        .card-green:hover { border-color: #10b981; background: rgba(16, 185, 129, 0.1); box-shadow: 0 0 20px rgba(16, 185, 129, 0.2); }
        .card-yellow:hover { border-color: #eab308; background: rgba(234, 179, 8, 0.1); box-shadow: 0 0 20px rgba(234, 179, 8, 0.2); }
        .card-red:hover { border-color: #ef4444; background: rgba(239, 68, 68, 0.1); box-shadow: 0 0 20px rgba(239, 68, 68, 0.2); }

        .squad-badge {
            font-family: 'Space Mono', monospace;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.1em;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            margin-bottom: 1rem;
            display: inline-block;
        }

        .tab-btn { position: relative; padding-bottom: 4px; }
        .tab-btn.active { color: currentColor; }
        .tab-btn.active::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 2px;
            background: currentColor; box-shadow: 0 0 8px currentColor;
        }

        .grid-cell { aspect-ratio: 1; border: 1px solid rgba(255, 255, 255, 0.1); cursor: pointer; transition: all 0.2s; }
        .grid-cell.active-blue { background-color: #3b82f6; box-shadow: inset 0 0 10px rgba(255,255,255,0.3); }
        .grid-cell.active-green { background-color: #10b981; box-shadow: inset 0 0 5px rgba(255,255,255,0.5); }
        
        mjx-container { font-size: 1.1em !important; }

        /* Animation for Errors */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-5px); }
            40% { transform: translateX(5px); }
            60% { transform: translateX(-5px); }
            80% { transform: translateX(5px); }
        }
        .input-error { animation: shake 0.4s ease-in-out; border-color: #ef4444 !important; color: #fca5a5 !important; }
        .input-success { border-color: #4ade80 !important; color: #4ade80 !important; }
    </style>
</head>
<body class="min-h-screen relative">
    <div id="star-container" class="star-field"></div>

    <!-- ========================================== -->
    <!-- VIEW: SPLASH PAGE (Mission Select)         -->
    <!-- ========================================== -->
    <div id="view-splash" class="min-h-screen flex flex-col items-center justify-center p-6 relative z-10">
        <div class="text-center max-w-5xl w-full">
            <span class="text-slate-400 font-mono tracking-[0.3em] uppercase text-xs md:text-sm mb-4 block animate-pulse">United Federation of Learning</span>
            <h1 class="text-5xl md:text-7xl font-extrabold mb-6 glow-text tracking-tight">Interplanetary<br>Practice</h1>
            <p class="text-slate-400 text-lg md:text-xl max-w-2xl mx-auto mb-16">
                Choose your mission protocol to begin training.
            </p>

            <div class="grid md:grid-cols-2 gap-8 w-full max-w-4xl mx-auto">
                <!-- Math Mission -->
                <button onclick="switchView('hub')" class="mission-card group glass p-10 border border-blue-500/30 text-left hover:shadow-[0_0_30px_rgba(59,130,246,0.3)]">
                    <div class="w-16 h-16 bg-blue-600/20 rounded-full flex items-center justify-center mb-6 text-blue-400 group-hover:bg-blue-600 group-hover:text-white transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12h20"/><path d="m5 12 5-9"/><path d="m19 12-5 9"/></svg>
                    </div>
                    <h2 class="text-3xl font-bold text-white mb-2 group-hover:text-blue-300">Math Operations</h2>
                    <p class="text-slate-400 text-sm">Squad-based tactical training in arithmetic, logic, and resource management.</p>
                    <div class="mt-8 flex gap-2">
                        <span class="px-3 py-1 bg-blue-500/10 text-blue-400 text-xs rounded border border-blue-500/20">Blue</span>
                        <span class="px-3 py-1 bg-emerald-500/10 text-emerald-400 text-xs rounded border border-emerald-500/20">Green</span>
                        <span class="px-3 py-1 bg-yellow-500/10 text-yellow-400 text-xs rounded border border-yellow-500/20">Yellow</span>
                        <span class="px-3 py-1 bg-red-500/10 text-red-400 text-xs rounded border border-red-500/20">Red</span>
                    </div>
                </button>

                <!-- Reading Mission -->
                <button onclick="switchView('reading')" class="mission-card group glass p-10 border border-purple-500/30 text-left hover:shadow-[0_0_30px_rgba(168,85,247,0.3)]">
                    <div class="w-16 h-16 bg-purple-600/20 rounded-full flex items-center justify-center mb-6 text-purple-400 group-hover:bg-purple-600 group-hover:text-white transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
                    </div>
                    <h2 class="text-3xl font-bold text-white mb-2 group-hover:text-purple-300">Linguistic Archives</h2>
                    <p class="text-slate-400 text-sm">Decode alien transmissions, analyze mission logs, and master galactic languages.</p>
                    <div class="mt-8">
                        <span class="px-3 py-1 bg-purple-500/10 text-purple-400 text-xs rounded border border-purple-500/20 font-mono">STATUS: CLASSIFIED</span>
                    </div>
                </button>
            </div>
            
            <p class="mt-16 text-slate-600 text-xs font-mono">Select a module to initiate launch sequence.</p>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- VIEW: MATH HUB (Squad Select)              -->
    <!-- ========================================== -->
    <div id="view-hub" class="hidden min-h-screen flex flex-col items-center justify-center p-6 relative z-10">
        <!-- Back Button -->
        <button onclick="switchView('splash')" class="absolute top-6 left-6 flex items-center gap-2 text-slate-400 hover:text-white transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
            <span class="font-mono text-sm">Return to Orbit</span>
        </button>

        <div class="text-center max-w-6xl w-full">
            <h1 class="text-4xl md:text-6xl font-extrabold mb-4 glow-text tracking-tight">Math Operations</h1>
            <p class="text-slate-400 text-lg md:text-xl max-w-2xl mx-auto mb-12">
                Select your Squad for targeted training.
            </p>

            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 w-full">
                <!-- BLUE SQUAD -->
                <button onclick="switchView('blue')" class="mission-card card-blue glass p-6 border border-blue-500/30 text-left">
                    <span class="squad-badge border border-blue-500 text-blue-400">Blue Squad</span>
                    <h2 class="text-2xl font-bold text-white mb-2">Elite Explorers</h2>
                    <p class="text-slate-400 text-sm mb-4 flex-grow">Advanced training in powers of 10, complex logistics, and fractions.</p>
                    <div class="text-xs text-blue-300 font-mono mt-auto">Grade 5 Standards<br>5.NS.3 • 5.CA.2</div>
                </button>

                <!-- GREEN SQUAD -->
                <button onclick="switchView('green')" class="mission-card card-green glass p-6 border border-emerald-500/30 text-left">
                    <span class="squad-badge border border-emerald-500 text-emerald-400">Green Squad</span>
                    <h2 class="text-2xl font-bold text-white mb-2">Commanders</h2>
                    <p class="text-slate-400 text-sm mb-4 flex-grow">Core operations: Decimals, multi-digit multiplication, and word problems.</p>
                    <div class="text-xs text-emerald-300 font-mono mt-auto">Grade 4 Standards<br>4.NS.6 • 4.C.2</div>
                </button>

                <!-- YELLOW SQUAD -->
                <button onclick="switchView('yellow')" class="mission-card card-yellow glass p-6 border border-yellow-500/30 text-left">
                    <span class="squad-badge border border-yellow-500 text-yellow-400">Yellow Squad</span>
                    <h2 class="text-2xl font-bold text-white mb-2">Specialists</h2>
                    <p class="text-slate-400 text-sm mb-4 flex-grow">Developing fluency in multiplication, division, and fractions.</p>
                    <div class="text-xs text-yellow-300 font-mono mt-auto">Grade 3 Standards<br>3.NS.3 • 3.C.1</div>
                </button>

                <!-- RED SQUAD -->
                <button onclick="switchView('red')" class="mission-card card-red glass p-6 border border-red-500/30 text-left">
                    <span class="squad-badge border border-red-500 text-red-400">Red Squad</span>
                    <h2 class="text-2xl font-bold text-white mb-2">Cadets</h2>
                    <p class="text-slate-400 text-sm mb-4 flex-grow">Building foundations in place value, addition, and subtraction.</p>
                    <div class="text-xs text-red-300 font-mono mt-auto">Grade 2 Standards<br>2.NS.1 • 2.CA.1</div>
                </button>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- VIEW: READING (Placeholder)                -->
    <!-- ========================================== -->
    <div id="view-reading" class="hidden min-h-screen flex items-center justify-center p-6 relative z-10">
        <div class="glass p-10 max-w-lg text-center border-purple-500/30 shadow-[0_0_50px_rgba(168,85,247,0.1)]">
            <div class="w-20 h-20 bg-purple-600/20 rounded-full flex items-center justify-center mb-6 mx-auto text-purple-400">
                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 15V3m0 12l-4-4m4 4 4-4M2 17l.621 2.485A2 2 0 0 0 4.561 21h14.878a2 2 0 0 0 1.94-1.515L22 17"/></svg>
            </div>
            <h2 class="text-3xl font-bold text-purple-300 mb-4">Access Denied</h2>
            <p class="text-slate-400 mb-8">The Linguistic Archives are currently sealed by Federation protocol. Please complete Math Operations training first.</p>
            <button onclick="switchView('splash')" class="px-8 py-3 bg-white/10 hover:bg-white/20 rounded-full border border-white/10 transition-colors">Return to Orbit</button>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- VIEW: BLUE SQUAD (Grade 5)                 -->
    <!-- ========================================== -->
    <div id="view-blue" class="hidden min-h-screen">
        <nav class="p-4 md:p-6 flex flex-col md:flex-row justify-between items-center gap-4 border-b border-blue-900/30 glass sticky top-0 z-50">
            <div class="flex items-center gap-3">
                <button onclick="switchView('hub')" class="p-2 -ml-2 hover:bg-white/10 rounded-full transition-colors text-blue-400" title="Return to Squad Command">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                </button>
                <h1 class="text-xl md:text-2xl font-bold tracking-tight glow-text text-blue-300">Blue Squad: Elite</h1>
            </div>
            <div class="flex flex-wrap justify-center gap-4 md:gap-6 text-xs md:text-sm text-blue-400">
                <button onclick="showBlueSection('briefs')" class="tab-btn active transition-all font-bold tracking-wider text-yellow-400" id="btn-blue-briefs">BRIEFING</button>
                <button onclick="showBlueSection('powers')" class="tab-btn transition-all" id="btn-blue-powers">POWERS OF 10</button>
                <button onclick="showBlueSection('percent')" class="tab-btn transition-all" id="btn-blue-percent">NEBULA NAV</button>
                <button onclick="showBlueSection('division')" class="tab-btn transition-all" id="btn-blue-division">LOGISTICS</button>
            </div>
        </nav>

        <main class="container mx-auto px-6 py-8">
            <!-- Blue Squad Content -->
            <section id="blue-briefs" class="max-w-4xl mx-auto space-y-8">
                <div class="glass p-8 border-l-4 border-yellow-400 bg-black/40">
                    <h3 class="text-2xl font-bold text-yellow-400 mb-4">Commander's Briefing</h3>
                    <p class="text-slate-300 mb-4">Welcome, Elite Explorers. Your mission involves mastering large-scale calculations.</p>
                    <ul class="space-y-4 text-sm text-slate-400">
                        <li class="bg-blue-900/20 p-3 rounded border border-blue-500/20"><strong class="text-blue-300 block mb-1">5.NS.3 (Warp Drive):</strong> Moving the decimal point based on powers of 10. Multiply $\rightarrow$ Right. Divide $\rightarrow$ Left.</li>
                        <li class="bg-emerald-900/20 p-3 rounded border border-emerald-500/20"><strong class="text-emerald-300 block mb-1">5.NS.4 (Nebula Nav):</strong> Understanding percents as parts of 100. $25\%$ is $\frac{25}{100}$ or $0.25$.</li>
                        <li class="bg-orange-900/20 p-3 rounded border border-orange-500/20"><strong class="text-orange-300 block mb-1">5.CA.2 (Logistics):</strong> Interpreting remainders. Round up for people, use decimals for fuel, drop remainder for money.</li>
                    </ul>
                    <div class="mt-8 text-center">
                        <button onclick="showBlueSection('powers')" class="px-6 py-2 bg-blue-600 rounded-full font-bold hover:bg-blue-500 transition-all">Begin Simulation</button>
                    </div>
                </div>
            </section>

            <section id="blue-powers" class="hidden space-y-8">
                <div class="glass p-8 border-l-4 border-blue-500">
                    <h3 class="text-2xl font-bold text-blue-400 mb-4">Warp Calculations</h3>
                    <div class="flex flex-col md:flex-row gap-8 items-center">
                        <div class="flex-1 text-center md:text-left">
                            <div id="drill-power-q" class="text-3xl font-mono text-white mb-4 bg-white/5 p-4 rounded">Press Start</div>
                            <div class="flex gap-2">
                                <input type="number" id="drill-power-input" placeholder="Result..." class="flex-1 bg-white/10 border border-white/20 rounded p-3 text-white outline-none focus:border-blue-500">
                                <button onclick="checkPowerDrill()" class="bg-blue-600 hover:bg-blue-500 px-6 rounded font-bold">Engage</button>
                            </div>
                            <div id="drill-power-feedback" class="mt-2 h-6 text-sm font-bold"></div>
                        </div>
                        <button onclick="generatePowerDrill()" class="px-6 py-2 border border-white/20 rounded-full hover:bg-white/10">New Coordinates</button>
                    </div>
                </div>
            </section>

            <section id="blue-percent" class="hidden space-y-8">
                <div class="glass p-8 border-l-4 border-emerald-500">
                    <h3 class="text-2xl font-bold text-emerald-400 mb-4">Nebula Navigation</h3>
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="flex flex-col items-center">
                            <div id="drill-percent-target" class="text-3xl font-mono text-white mb-4">Target: ---</div>
                            <button onclick="checkPercentDrill()" class="w-full py-3 bg-emerald-600 hover:bg-emerald-500 rounded font-bold mb-2">Verify Grid</button>
                            <button onclick="generatePercentDrill()" class="w-full py-2 bg-white/10 hover:bg-white/20 rounded">New Signal</button>
                            <div id="drill-percent-feedback" class="mt-2 h-6 text-sm font-bold text-center"></div>
                        </div>
                        <div class="flex justify-center">
                            <div id="percent-grid" class="grid grid-cols-10 grid-rows-10 gap-1 w-[300px] h-[300px]"></div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="blue-division" class="hidden space-y-8">
                <div class="glass p-8 border-l-4 border-orange-500">
                    <h3 class="text-2xl font-bold text-orange-400 mb-4">Logistics Control</h3>
                    <div class="bg-black/30 p-6 rounded border border-white/10 mb-6 min-h-[100px] flex items-center justify-center">
                        <p id="logistics-text" class="text-lg text-center text-slate-200">Awaiting scenario...</p>
                    </div>
                    <div id="logistics-options" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"></div>
                    <div class="text-center">
                        <button onclick="generateLogisticsDrill()" class="px-8 py-2 bg-orange-600 hover:bg-orange-500 rounded-full font-bold">Next Scenario</button>
                        <div id="logistics-feedback" class="mt-4 h-6 font-bold text-sm"></div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- ========================================== -->
    <!-- VIEW: GREEN SQUAD (Grade 4)                -->
    <!-- ========================================== -->
    <div id="view-green" class="hidden min-h-screen">
        <nav class="p-4 md:p-6 flex flex-col md:flex-row justify-between items-center gap-4 border-b border-emerald-900/30 glass sticky top-0 z-50">
            <div class="flex items-center gap-3">
                <button onclick="switchView('hub')" class="p-2 -ml-2 hover:bg-white/10 rounded-full transition-colors text-emerald-400" title="Return to Squad Command">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                </button>
                <h1 class="text-xl md:text-2xl font-bold tracking-tight glow-text text-emerald-300">Green Squad: Commanders</h1>
            </div>
            <div class="flex gap-6 text-sm text-emerald-400">
                <button onclick="showGreenSection('decimals')" class="tab-btn active transition-all" id="btn-green-decimals">DECIMAL RADAR</button>
                <button onclick="showGreenSection('cargo')" class="tab-btn transition-all" id="btn-green-cargo">CARGO OPS</button>
                <button onclick="showGreenSection('mission')" class="tab-btn transition-all" id="btn-green-mission">MISSION LOGS</button>
            </div>
        </nav>

        <main class="container mx-auto px-6 py-8">
            <section id="green-decimals" class="space-y-8">
                <div class="glass p-8 border-l-4 border-emerald-500">
                    <h3 class="text-2xl font-bold text-emerald-400 mb-4">Decimal Radar (4.NS.6)</h3>
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="flex flex-col items-center justify-center space-y-4">
                            <div id="radar-target" class="text-4xl font-bold text-white bg-emerald-900/40 px-8 py-4 rounded-xl border border-emerald-500/30">Target: ---</div>
                            <div class="flex gap-4 w-full">
                                <button onclick="generateDecimalDrill()" class="flex-1 py-3 bg-white/10 hover:bg-white/20 rounded font-bold">New Target</button>
                                <button onclick="checkDecimalDrill()" class="flex-1 py-3 bg-emerald-600 hover:bg-emerald-500 rounded font-bold">Scan</button>
                            </div>
                            <div id="decimal-feedback" class="h-6 font-bold text-sm"></div>
                        </div>
                        <div class="flex justify-center">
                            <div id="decimal-grid" class="grid grid-cols-10 grid-rows-10 gap-1 w-[300px] h-[300px] bg-black/40 p-2 rounded"></div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="green-cargo" class="hidden space-y-8">
                <div class="glass p-8 border-l-4 border-blue-500 text-center">
                    <h3 class="text-2xl font-bold text-blue-400 mb-4">Cargo Operations (4.C.2)</h3>
                    <div id="cargo-problem" class="text-4xl font-mono text-white mb-6">Press New Manifest</div>
                    <div class="max-w-xs mx-auto mb-4">
                        <input type="number" id="cargo-input" placeholder="Total Weight..." class="w-full bg-white/10 border border-white/20 rounded p-3 text-white text-center text-xl outline-none focus:border-blue-500">
                    </div>
                    <div class="flex gap-4 justify-center">
                        <button onclick="generateCargoDrill()" class="px-6 py-2 bg-white/10 hover:bg-white/20 rounded">New Manifest</button>
                        <button onclick="checkCargoDrill()" class="px-6 py-2 bg-blue-600 hover:bg-blue-500 rounded font-bold">Verify</button>
                    </div>
                    <div id="cargo-feedback" class="mt-4 h-6 font-bold text-sm"></div>
                </div>
            </section>

            <section id="green-mission" class="hidden space-y-8">
                <div class="glass p-8 border-l-4 border-yellow-500">
                    <h3 class="text-2xl font-bold text-yellow-400 mb-4">Mission Logs (4.AT.1)</h3>
                    <div class="bg-black/30 p-6 rounded border border-white/10 mb-6 min-h-[100px] flex items-center justify-center">
                        <p id="mission-text" class="text-lg text-slate-200 text-center">Awaiting Mission Parameters...</p>
                    </div>
                    <div id="mission-options" class="grid md:grid-cols-2 gap-4 mb-6"></div>
                    <div class="text-center">
                        <button onclick="generateMission()" class="px-8 py-2 bg-yellow-600 hover:bg-yellow-500 rounded-full font-bold">Receive Orders</button>
                        <div id="mission-feedback" class="mt-4 h-6 font-bold text-sm"></div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- ========================================== -->
    <!-- VIEW: YELLOW SQUAD (Placeholder)           -->
    <!-- ========================================== -->
    <div id="view-yellow" class="hidden min-h-screen flex items-center justify-center">
        <div class="glass p-10 max-w-lg text-center border-yellow-500/30">
            <h2 class="text-3xl font-bold text-yellow-300 mb-4">Specialists Module</h2>
            <p class="text-slate-400 mb-6">Training for Grade 3 standards is currently under construction by Federation engineers.</p>
            <button onclick="switchView('hub')" class="px-6 py-2 bg-white/10 hover:bg-white/20 rounded-full">Return to Squad Command</button>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- VIEW: RED SQUAD (Placeholder)              -->
    <!-- ========================================== -->
    <div id="view-red" class="hidden min-h-screen flex items-center justify-center">
        <div class="glass p-10 max-w-lg text-center border-red-500/30">
            <h2 class="text-3xl font-bold text-red-300 mb-4">Cadets Module</h2>
            <p class="text-slate-400 mb-6">Training for Grade 2 standards is currently under construction by Federation engineers.</p>
            <button onclick="switchView('hub')" class="px-6 py-2 bg-white/10 hover:bg-white/20 rounded-full">Return to Squad Command</button>
        </div>
    </div>

    <script>
        // --- CORE SYSTEM ---
        const starContainer = document.getElementById('star-container');
        for (let i = 0; i < 150; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            const size = Math.random() * 3 + 'px';
            star.style.width = size; star.style.height = size;
            star.style.top = Math.random() * 100 + '%'; star.style.left = Math.random() * 100 + '%';
            star.style.setProperty('--duration', (Math.random() * 3 + 2) + 's');
            starContainer.appendChild(star);
        }

        function switchView(viewName) {
            ['splash', 'hub', 'reading', 'blue', 'green', 'yellow', 'red'].forEach(v => {
                document.getElementById('view-' + v).classList.add('hidden');
            });
            document.getElementById('view-' + viewName).classList.remove('hidden');
            window.scrollTo(0,0);

            // Init specific modules on load
            if (viewName === 'blue' && !blueState.init) initBlueSquad();
            if (viewName === 'green' && !greenState.init) initGreenSquad();
        }

        // --- BLUE SQUAD LOGIC (Grade 5) ---
        const blueState = { init: false, currentPowerAns: 0, currentPercentTarget: 0, currentLogisticsAns: null };

        function showBlueSection(id) {
            ['briefs', 'powers', 'percent', 'division'].forEach(s => {
                document.getElementById('blue-' + s).classList.add('hidden');
                document.getElementById('btn-blue-' + s).classList.remove('active', 'text-blue-300');
            });
            document.getElementById('blue-' + id).classList.remove('hidden');
            document.getElementById('btn-blue-' + id).classList.add('active', 'text-blue-300');
            if (window.MathJax) MathJax.typesetPromise();
        }

        function initBlueSquad() {
            blueState.init = true;
            generatePowerDrill();
            
            // Build Blue Percent Grid
            const grid = document.getElementById('percent-grid');
            for (let i = 1; i <= 100; i++) {
                const cell = document.createElement('div');
                cell.className = 'grid-cell';
                cell.onclick = () => {
                    const cells = grid.querySelectorAll('.grid-cell');
                    cells.forEach((c, idx) => c.classList.toggle('active-blue', idx < i));
                };
                grid.appendChild(cell);
            }
            generatePercentDrill();
            generateLogisticsDrill();
        }

        function generatePowerDrill() {
            const isMult = Math.random() > 0.5;
            const base = (Math.random() * 100).toFixed(1);
            const exp = Math.floor(Math.random() * 3) + 1;
            blueState.currentPowerAns = isMult ? (base * Math.pow(10, exp)) : (base / Math.pow(10, exp));
            // Precision fix
            blueState.currentPowerAns = parseFloat(blueState.currentPowerAns.toPrecision(10));
            
            const symbol = isMult ? "\\times" : "\\div";
            const qEl = document.getElementById('drill-power-q');
            qEl.innerHTML = `$${base} ${symbol} 10^{${exp}} = ?$`;
            document.getElementById('drill-power-input').value = '';
            document.getElementById('drill-power-feedback').innerText = '';
            document.getElementById('drill-power-input').classList.remove('input-error', 'input-success');
            if(window.MathJax) MathJax.typesetPromise([qEl]);
        }

        function checkPowerDrill() {
            const input = document.getElementById('drill-power-input');
            const val = parseFloat(input.value);
            const fb = document.getElementById('drill-power-feedback');
            input.classList.remove('input-error', 'input-success');
            void input.offsetWidth; // Trigger reflow

            if (Math.abs(val - blueState.currentPowerAns) < 0.00001) {
                fb.innerText = "CORRECT: Warp stabilized.";
                fb.className = "mt-2 h-6 text-sm font-bold text-green-400";
                input.classList.add('input-success');
            } else {
                fb.innerText = "ERROR: Calculation unstable.";
                fb.className = "mt-2 h-6 text-sm font-bold text-red-400";
                input.classList.add('input-error');
            }
        }

        function generatePercentDrill() {
            blueState.currentPercentTarget = Math.floor(Math.random() * 90) + 5;
            document.getElementById('drill-percent-target').innerText = `Target: ${blueState.currentPercentTarget}%`;
            document.getElementById('drill-percent-feedback').innerText = '';
            // Reset grid
            document.querySelectorAll('#percent-grid .grid-cell').forEach(c => c.classList.remove('active-blue'));
        }

        function checkPercentDrill() {
            const active = document.querySelectorAll('#percent-grid .active-blue').length;
            const fb = document.getElementById('drill-percent-feedback');
            if (active === blueState.currentPercentTarget) {
                fb.innerText = "SIGNAL LOCKED.";
                fb.className = "mt-2 h-6 text-sm font-bold text-green-400";
            } else {
                fb.innerText = `MISMATCH: Reading ${active}%.`;
                fb.className = "mt-2 h-6 text-sm font-bold text-red-400";
            }
        }

        function generateLogisticsDrill() {
            const scenarios = [
                { t: (t,c)=>`Evac: ${t} people, ${c}/ship. Ships needed?`, l: (t,c)=>Math.ceil(t/c) },
                { t: (t,c)=>`Fuel: ${t} tons, ${c} bases. Tons/base?`, l: (t,c)=>parseFloat((t/c).toFixed(2)) },
                { t: (t,c)=>`Budget: ${t} credits, ${c}/item. Max items?`, l: (t,c)=>Math.floor(t/c) }
            ];
            const s = scenarios[Math.floor(Math.random()*scenarios.length)];
            const n1 = Math.floor(Math.random()*500)+100, n2 = Math.floor(Math.random()*20)+5;
            
            blueState.currentLogisticsAns = s.l(n1, n2);
            document.getElementById('logistics-text').innerText = s.t(n1, n2);
            document.getElementById('logistics-feedback').innerText = '';
            
            const opts = document.getElementById('logistics-options');
            opts.innerHTML = '';
            const ans = [blueState.currentLogisticsAns];
            while(ans.length < 3) {
                let r = blueState.currentLogisticsAns + Math.floor(Math.random()*10)-5;
                if(r>0 && !ans.includes(r)) ans.push(r);
            }
            ans.sort((a,b)=>a-b).forEach(a => {
                const btn = document.createElement('button');
                btn.className = "p-4 bg-white/5 border border-white/10 rounded hover:bg-white/10 text-left font-mono";
                btn.innerText = a;
                btn.onclick = () => {
                    const fb = document.getElementById('logistics-feedback');
                    if(a === blueState.currentLogisticsAns) {
                        fb.innerText = "APPROVED."; fb.className = "mt-4 h-6 font-bold text-sm text-green-400";
                    } else {
                        fb.innerText = "REJECTED."; fb.className = "mt-4 h-6 font-bold text-sm text-red-400";
                    }
                };
                opts.appendChild(btn);
            });
        }


        // --- GREEN SQUAD LOGIC (Grade 4) ---
        const greenState = { init: false, currentDecimalTarget: 0, currentCargoAns: 0, currentMissionAns: 0 };

        function showGreenSection(id) {
            ['decimals', 'cargo', 'mission'].forEach(s => {
                document.getElementById('green-' + s).classList.add('hidden');
                document.getElementById('btn-green-' + s).classList.remove('active', 'text-emerald-300');
            });
            document.getElementById('green-' + id).classList.remove('hidden');
            document.getElementById('btn-green-' + id).classList.add('active', 'text-emerald-300');
            if (window.MathJax) MathJax.typesetPromise();
        }

        function initGreenSquad() {
            greenState.init = true;
            generateDecimalDrill();
            generateCargoDrill();
            generateMission();
            
            const grid = document.getElementById('decimal-grid');
            for (let i = 1; i <= 100; i++) {
                const cell = document.createElement('div');
                cell.className = 'grid-cell';
                cell.onclick = () => {
                    const cells = grid.querySelectorAll('.grid-cell');
                    cells.forEach((c, idx) => c.classList.toggle('active-green', idx < i));
                };
                grid.appendChild(cell);
            }
        }

        function generateDecimalDrill() {
            greenState.currentDecimalTarget = Math.floor(Math.random() * 90) + 1;
            const isFrac = Math.random() > 0.5;
            const targetEl = document.getElementById('radar-target');
            if (isFrac) {
                targetEl.innerHTML = `Target: $\\frac{${greenState.currentDecimalTarget}}{100}$`;
                if(window.MathJax) MathJax.typesetPromise([targetEl]);
            } else {
                targetEl.innerText = `Target: ${(greenState.currentDecimalTarget/100).toFixed(2)}`;
            }
            document.querySelectorAll('#decimal-grid .grid-cell').forEach(c => c.classList.remove('active-green'));
            document.getElementById('decimal-feedback').innerText = "";
        }

        function checkDecimalDrill() {
            const filled = document.querySelectorAll('#decimal-grid .active-green').length;
            const fb = document.getElementById('decimal-feedback');
            if (filled === greenState.currentDecimalTarget) {
                fb.innerText = "RADAR CALIBRATED.";
                fb.className = "h-6 font-bold text-sm text-emerald-400";
            } else {
                fb.innerText = `ERROR: ${filled}/100 active.`;
                fb.className = "h-6 font-bold text-sm text-red-400";
            }
        }

        function generateCargoDrill() {
            const n1 = Math.floor(Math.random() * 80) + 10;
            const n2 = Math.floor(Math.random() * 80) + 10;
            greenState.currentCargoAns = n1 * n2;
            document.getElementById('cargo-problem').innerText = `${n1} × ${n2}`;
            document.getElementById('cargo-input').value = '';
            document.getElementById('cargo-feedback').innerText = '';
        }

        function checkCargoDrill() {
            const val = parseInt(document.getElementById('cargo-input').value);
            const fb = document.getElementById('cargo-feedback');
            if (val === greenState.currentCargoAns) {
                fb.innerText = "VERIFIED."; fb.className = "mt-4 h-6 font-bold text-sm text-blue-400";
            } else {
                fb.innerText = "MISMATCH."; fb.className = "mt-4 h-6 font-bold text-sm text-red-400";
            }
        }

        function generateMission() {
            const n1 = Math.floor(Math.random()*5000)+1000, n2 = Math.floor(Math.random()*500)+100;
            const isAdd = Math.random() > 0.5;
            greenState.currentMissionAns = isAdd ? n1 + n2 : n1 - n2;
            document.getElementById('mission-text').innerText = isAdd 
                ? `Transport A (${n1}kg) and Transport B (${n2}kg) link up. Total mass?`
                : `Supply Depot had ${n1} units. Ships took ${n2}. Remaining?`;
            
            const opts = document.getElementById('mission-options');
            opts.innerHTML = '';
            const ans = [greenState.currentMissionAns, greenState.currentMissionAns+10, greenState.currentMissionAns-100, greenState.currentMissionAns+50].sort(()=>Math.random()-0.5);
            
            ans.forEach(a => {
                const btn = document.createElement('button');
                btn.className = "p-4 bg-white/5 border border-white/10 rounded hover:bg-white/10 text-left font-mono";
                btn.innerText = a;
                btn.onclick = () => {
                     const fb = document.getElementById('mission-feedback');
                     if(a === greenState.currentMissionAns) {
                         fb.innerText = "CONFIRMED."; fb.className = "mt-4 h-6 font-bold text-sm text-green-400";
                     } else {
                         fb.innerText = "ERROR."; fb.className = "mt-4 h-6 font-bold text-sm text-red-400";
                     }
                };
                opts.appendChild(btn);
            });
            document.getElementById('mission-feedback').innerText = '';
        }
    </script>
</body>
</html>
